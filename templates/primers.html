{% extends 'base.html' %}

{% block content %}
<!-- Sidebar for displaying the primer list using DataTables and Bulma -->
<aside class="menu">
    <p class="menu-label">
        Primer Lists
    </p>
    <ul class="menu-list">
        <!-- Using DataTables to display the primer list -->
        <table id="primerListTable" class="table is-striped is-hoverable is-fullwidth">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Visibility</th>
                </tr>
            </thead>
            <tbody>
                {% for primer_list in primer_lists %}
                    {% if primer_list.visibility == 'public' or (primer_list.visibility == 'private' and primer_list.user_id == current_user.id) %}
                        <tr>
                            <td>{{ primer_list.name }}</td>
                            <td>{{ primer_list.visibility }}</td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
    </ul>
</aside>

<!-- Placeholder for additional content, if needed -->
<div class="content">
    <!-- Any additional content can go here -->
</div>
{% endblock %}

{% block scripts %}
<script>
    var groupColumn = 1;  // This should be 1 for the Visibility column, since columns are 0-indexed
    var table = $('#primerListTable').DataTable({
        columnDefs: [{ visible: false, targets: groupColumn }],
        order: [[groupColumn, 'asc']],
        displayLength: 25,
        drawCallback: function (settings) {
            var api = this.api();
            var rows = api.rows({ page: 'current' }).nodes();
            var last = null;

            api.column(groupColumn, { page: 'current' })
                .data()
                .each(function (group, i) {
                    if (last !== group) {
                        $(rows)
                            .eq(i)
                            .before(
                                '<tr class="group"><td colspan="2">' +
                                    group +
                                    '</td></tr>'
                            );

                        last = group;
                    }
                });
        }
    });

    // Order by the grouping
    $('#primerListTable tbody').on('click', 'tr.group', function () {
        var currentOrder = table.order()[0];
        if (currentOrder[0] === groupColumn && currentOrder[1] === 'asc') {
            table.order([groupColumn, 'desc']).draw();
        }
        else {
            table.order([groupColumn, 'asc']).draw();
        }
    });
</script>
{% endblock %}
